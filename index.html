<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Fahrzeuganalyse</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Fahrzeugaufkommen (interaktiv)</h1>
    <div id="plot"></div>
    <script>
    fetch('Daten/vehicle_counts.txt')
      .then(response => response.text())
      .then(text => {
        const lines = text.split('\n').filter(l => l.trim() !== '');

        // Daten sammeln
        const timestamps = [];
        const types = [];
        lines.forEach(line => {
          const parts = line.split(',');
          if(parts.length === 3) {
            const ts = parts[0].trim() + ' ' + parts[1].trim();
            timestamps.push(ts);
            types.push(parts[2].trim());
          }
        });

        // Fahrzeugtypen zählen je Zeitstempel
        const uniqueTypes = [...new Set(types)];
        const dataPerType = {};
        uniqueTypes.forEach(type => dataPerType[type] = {x: [], y: []});

        timestamps.forEach((ts, idx) => {
          const type = types[idx];
          dataPerType[type].x.push(ts);
          dataPerType[type].y.push(1); // Einzelne Zählung
        });

        // Summen pro Typ für Balkendiagramm
        const counts = uniqueTypes.map(type => types.filter(t => t === type).length);

        // Zeitverlauf Liniendiagramm je Typ
        const traces = uniqueTypes.map(type => ({
          x: dataPerType[type].x,
          y: dataPerType[type].y.map((v,i)=>i+1), // kumulativ für schöne Linien
          mode: 'lines+markers',
          name: type
        }));

        // Balkendiagramm
        traces.push({
          x: uniqueTypes,
          y: counts,
          type: 'bar',
          name: 'Summe',
          marker: {opacity:0.5, color:'gray'},
          yaxis: 'y2'
        });

        const layout = {
          title: 'Fahrzeugaufkommen nach Typ und Zeit',
          xaxis: {title: 'Zeit / Typ'},
          yaxis: {title: 'Kumulative Anzahl'},
          yaxis2: {
            title: 'Gesamtsumme',
            overlaying: 'y',
            side: 'right',
            showgrid: false
          },
          legend: {x:1.05, y:1}
        };

        Plotly.newPlot('plot', traces, layout);
      });
    </script>
</body>
</html>
